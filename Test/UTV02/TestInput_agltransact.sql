--Dette grunnlaget skal resultere i et GL07 bilag som er 4000 credit og 4000 debit. Om det er forskjellig er det noe feil i logikken.
BEGIN TRAN
DECLARE @hbvoucherno bigint;
SELECT @hbvoucherno = (SELECT counter FROM acrtransgr WHERE client='BT' AND vouch_series='HB') 

INSERT [dbo].[agltransact] ([account], [amount], [apar_id], [apar_type], [att_1_id], [att_2_id], [att_3_id], [att_4_id], [att_5_id], [att_6_id], [att_7_id], [client], [cur_amount], [currency], [dc_flag], [description], [dim_1], [dim_2], [dim_3], [dim_4], [dim_5], [dim_6], [dim_7], [ext_arch_ref], [ext_inv_ref], [ext_ref], [number_1], [order_id], [period], [sequence_no], [status], [tax_code], [tax_system], [trans_date], [value_1], [value_2], [value_3], [voucher_date], [voucher_no], [voucher_type]) VALUES (N'6000', CAST(0.000 AS Decimal(28, 3)), N'', N' ', N'C1  ', N'B0  ', N'    ', N'    ', N'BF  ', N'C0  ', N'    ', N'BT', CAST(0.000 AS Decimal(28, 3)), N'NOK', 1, N'EF-test: Row 1, 0 kr, kostnad på bidragsprosjekt', N'13601010', N'110003', N'', N'', N'110003101', N'99999', N'', N'                                                  ', N'', N'', 0, 0, 201911, 0, N' ', N'0', N'', CAST(N'2019-11-15 10:02:53.880' AS DateTime), CAST(0.00000000 AS Decimal(28, 8)), CAST(0.000 AS Decimal(28, 3)), CAST(0.000 AS Decimal(28, 3)), CAST(N'2019-11-15 10:02:53.880' AS DateTime), @hbvoucherno, N'HB')
INSERT [dbo].[agltransact] ([account], [amount], [apar_id], [apar_type], [att_1_id], [att_2_id], [att_3_id], [att_4_id], [att_5_id], [att_6_id], [att_7_id], [client], [cur_amount], [currency], [dc_flag], [description], [dim_1], [dim_2], [dim_3], [dim_4], [dim_5], [dim_6], [dim_7], [ext_arch_ref], [ext_inv_ref], [ext_ref], [number_1], [order_id], [period], [sequence_no], [status], [tax_code], [tax_system], [trans_date], [value_1], [value_2], [value_3], [voucher_date], [voucher_no], [voucher_type]) VALUES (N'6000', CAST(1000.000 AS Decimal(28, 3)), N'', N' ', N'C1  ', N'B0  ', N'    ', N'    ', N'BF  ', N'C0  ', N'    ', N'BT', CAST(1000.000 AS Decimal(28, 3)), N'NOK', 1, N'EF-test: Row 2, kostnad på bidragsprosjekt', N'13601010', N'110003', N'', N'', N'110003101', N'99999', N'', N'                                                  ', N'', N'', 0, 0, 201911, 0, N' ', N'0', N'', CAST(N'2019-11-15 09:12:57.927' AS DateTime), CAST(0.00000000 AS Decimal(28, 8)), CAST(0.000 AS Decimal(28, 3)), CAST(0.000 AS Decimal(28, 3)), CAST(N'2019-11-15 09:12:57.927' AS DateTime), @hbvoucherno+1, N'HB')
INSERT [dbo].[agltransact] ([account], [amount], [apar_id], [apar_type], [att_1_id], [att_2_id], [att_3_id], [att_4_id], [att_5_id], [att_6_id], [att_7_id], [client], [cur_amount], [currency], [dc_flag], [description], [dim_1], [dim_2], [dim_3], [dim_4], [dim_5], [dim_6], [dim_7], [ext_arch_ref], [ext_inv_ref], [ext_ref], [number_1], [order_id], [period], [sequence_no], [status], [tax_code], [tax_system], [trans_date], [value_1], [value_2], [value_3], [voucher_date], [voucher_no], [voucher_type]) VALUES (N'6000', CAST(-1000.000 AS Decimal(28, 3)), N'', N' ', N'C1  ', N'B0  ', N'    ', N'    ', N'BF  ', N'C0  ', N'    ', N'BT', CAST(-1000.000 AS Decimal(28, 3)), N'NOK', -1, N'EF-test: Row 3, negativ kostnad på bidragsprosjekt', N'13601010', N'110003', N'', N'', N'110003101', N'99999', N'', N'                                                  ', N'', N'', 0, 0, 201911, 0, N' ', N'0', N'', CAST(N'2019-11-15 09:12:57.927' AS DateTime), CAST(0.00000000 AS Decimal(28, 8)), CAST(0.000 AS Decimal(28, 3)), CAST(0.000 AS Decimal(28, 3)), CAST(N'2019-11-15 09:12:57.927' AS DateTime), @hbvoucherno+2, N'HB')
INSERT [dbo].[agltransact] ([account], [amount], [apar_id], [apar_type], [att_1_id], [att_2_id], [att_3_id], [att_4_id], [att_5_id], [att_6_id], [att_7_id], [client], [cur_amount], [currency], [dc_flag], [description], [dim_1], [dim_2], [dim_3], [dim_4], [dim_5], [dim_6], [dim_7], [ext_arch_ref], [ext_inv_ref], [ext_ref], [number_1], [order_id], [period], [sequence_no], [status], [tax_code], [tax_system], [trans_date], [value_1], [value_2], [value_3], [voucher_date], [voucher_no], [voucher_type]) VALUES (N'6000', CAST(1000.000 AS Decimal(28, 3)), N'', N' ', N'C1  ', N'B0  ', N'    ', N'    ', N'BF  ', N'C0  ', N'    ', N'BT', CAST(1000.000 AS Decimal(28, 3)), N'NOK', 1, N'EF-test: Row 4, kostnad på bidragssprosjekt på delprosjekt != egenfinansieringsdelprosjekt', N'13601010', N'110003', N'', N'', N'110003100', N'99999', N'', N'                                                  ', N'', N'', 0, 0, 201911, 0, N' ', N'0', N'', CAST(N'2019-11-15 09:25:53.000' AS DateTime), CAST(0.00000000 AS Decimal(28, 8)), CAST(0.000 AS Decimal(28, 3)), CAST(0.000 AS Decimal(28, 3)), CAST(N'2019-11-15 09:25:53.000' AS DateTime), @hbvoucherno+3, N'HB')
INSERT [dbo].[agltransact] ([account], [amount], [apar_id], [apar_type], [att_1_id], [att_2_id], [att_3_id], [att_4_id], [att_5_id], [att_6_id], [att_7_id], [client], [cur_amount], [currency], [dc_flag], [description], [dim_1], [dim_2], [dim_3], [dim_4], [dim_5], [dim_6], [dim_7], [ext_arch_ref], [ext_inv_ref], [ext_ref], [number_1], [order_id], [period], [sequence_no], [status], [tax_code], [tax_system], [trans_date], [value_1], [value_2], [value_3], [voucher_date], [voucher_no], [voucher_type]) VALUES (N'6000', CAST(1000.000 AS Decimal(28, 3)), N'', N' ', N'C1  ', N'B0  ', N'    ', N'    ', N'BF  ', N'C0  ', N'    ', N'BT', CAST(1000.000 AS Decimal(28, 3)), N'NOK', 1, N'EF-test: Row 5, kostnad på oppdragsprosjekt', N'12600000', N'110011', N'', N'', N'110011100', N'99999', N'', N'                                                  ', N'', N'', 0, 0, 201911, 0, N' ', N'0', N'', CAST(N'2019-11-15 09:24:11.177' AS DateTime), CAST(0.00000000 AS Decimal(28, 8)), CAST(0.000 AS Decimal(28, 3)), CAST(0.000 AS Decimal(28, 3)), CAST(N'2019-11-15 09:24:11.177' AS DateTime), @hbvoucherno+4, N'HB')
INSERT [dbo].[agltransact] ([account], [amount], [apar_id], [apar_type], [att_1_id], [att_2_id], [att_3_id], [att_4_id], [att_5_id], [att_6_id], [att_7_id], [client], [cur_amount], [currency], [dc_flag], [description], [dim_1], [dim_2], [dim_3], [dim_4], [dim_5], [dim_6], [dim_7], [ext_arch_ref], [ext_inv_ref], [ext_ref], [number_1], [order_id], [period], [sequence_no], [status], [tax_code], [tax_system], [trans_date], [value_1], [value_2], [value_3], [voucher_date], [voucher_no], [voucher_type]) VALUES (N'6000', CAST(1000.000 AS Decimal(28, 3)), N'', N' ', N'C1  ', N'B0  ', N'    ', N'    ', N'BF  ', N'C0  ', N'    ', N'BT', CAST(1000.000 AS Decimal(28, 3)), N'NOK', 1, N'EF-test: Row 6, kostnad på interntprosjekt', N'20100000', N'120002', N'', N'', N'120002100', N'99999', N'', N'                                                  ', N'', N'', 0, 0, 201911, 0, N' ', N'0', N'', CAST(N'2019-11-15 09:29:14.497' AS DateTime), CAST(0.00000000 AS Decimal(28, 8)), CAST(0.000 AS Decimal(28, 3)), CAST(0.000 AS Decimal(28, 3)), CAST(N'2019-11-15 09:29:14.497' AS DateTime), @hbvoucherno+5, N'HB')
INSERT [dbo].[agltransact] ([account], [amount], [apar_id], [apar_type], [att_1_id], [att_2_id], [att_3_id], [att_4_id], [att_5_id], [att_6_id], [att_7_id], [client], [cur_amount], [currency], [dc_flag], [description], [dim_1], [dim_2], [dim_3], [dim_4], [dim_5], [dim_6], [dim_7], [ext_arch_ref], [ext_inv_ref], [ext_ref], [number_1], [order_id], [period], [sequence_no], [status], [tax_code], [tax_system], [trans_date], [value_1], [value_2], [value_3], [voucher_date], [voucher_no], [voucher_type]) VALUES (N'9421', CAST(1000.000 AS Decimal(28, 3)), N'', N' ', N'C1  ', N'B0  ', N'    ', N'    ', N'BF  ', N'C0  ', N'    ', N'BT', CAST(1000.000 AS Decimal(28, 3)), N'NOK', 1, N'EF-test: Row 7, kostnad på bidragsprosjekt ført på leiestedskonto og koststes != delprosjektets.', N'12600000', N'110003', N'', N'', N'110003101', N'99999', N'', N'                                                  ', N'', N'', 0, 0, 201911, 0, N' ', N'0', N'', CAST(N'2019-11-15 09:54:58.460' AS DateTime), CAST(0.00000000 AS Decimal(28, 8)), CAST(0.000 AS Decimal(28, 3)), CAST(0.000 AS Decimal(28, 3)), CAST(N'2019-11-15 09:54:58.460' AS DateTime), @hbvoucherno+6, N'HB')
INSERT [dbo].[agltransact] ([account], [amount], [apar_id], [apar_type], [att_1_id], [att_2_id], [att_3_id], [att_4_id], [att_5_id], [att_6_id], [att_7_id], [client], [cur_amount], [currency], [dc_flag], [description], [dim_1], [dim_2], [dim_3], [dim_4], [dim_5], [dim_6], [dim_7], [ext_arch_ref], [ext_inv_ref], [ext_ref], [number_1], [order_id], [period], [sequence_no], [status], [tax_code], [tax_system], [trans_date], [value_1], [value_2], [value_3], [voucher_date], [voucher_no], [voucher_type]) VALUES (N'6000', CAST(1000.000 AS Decimal(28, 3)), N'', N' ', N'C1  ', N'B0  ', N'    ', N'    ', N'    ', N'C0  ', N'    ', N'BT', CAST(1000.000 AS Decimal(28, 3)), N'NOK', 1, N'EF-test: Row 8, kostnad på bidragsprosjekt uten delprosjekt med ressurs', N'13601010', N'110003', N'', N'', N'', N'99999', N'', N'                                                  ', N'', N'', 0, 0, 201911, 0, N' ', N'0', N'', CAST(N'2019-11-15 09:57:30.110' AS DateTime), CAST(0.00000000 AS Decimal(28, 8)), CAST(0.000 AS Decimal(28, 3)), CAST(0.000 AS Decimal(28, 3)), CAST(N'2019-11-15 09:57:30.110' AS DateTime), @hbvoucherno+7, N'HB')
INSERT [dbo].[agltransact] ([account], [amount], [apar_id], [apar_type], [att_1_id], [att_2_id], [att_3_id], [att_4_id], [att_5_id], [att_6_id], [att_7_id], [client], [cur_amount], [currency], [dc_flag], [description], [dim_1], [dim_2], [dim_3], [dim_4], [dim_5], [dim_6], [dim_7], [ext_arch_ref], [ext_inv_ref], [ext_ref], [number_1], [order_id], [period], [sequence_no], [status], [tax_code], [tax_system], [trans_date], [value_1], [value_2], [value_3], [voucher_date], [voucher_no], [voucher_type]) VALUES (N'6000', CAST(1000.000 AS Decimal(28, 3)), N'', N' ', N'C1  ', N'B0  ', N'    ', N'    ', N'BF  ', N'C0  ', N'    ', N'BT', CAST(1000.000 AS Decimal(28, 3)), N'NOK', 1, N'EF-test: Row 9, kostnad på bidragsprosjekt i en annen periode', N'13601010', N'110003', N'', N'', N'110003101', N'99999', N'', N'                                                  ', N'', N'', 0, 0, 201912, 0, N' ', N'0', N'', CAST(N'2019-12-15 10:02:53.880' AS DateTime), CAST(0.00000000 AS Decimal(28, 8)), CAST(0.000 AS Decimal(28, 3)), CAST(0.000 AS Decimal(28, 3)), CAST(N'2019-12-15 10:02:53.880' AS DateTime), @hbvoucherno+8, N'HB')

INSERT [dbo].[agltransact] ([account], [amount], [apar_id], [apar_type], [att_1_id], [att_2_id], [att_3_id], [att_4_id], [att_5_id], [att_6_id], [att_7_id], [client], [cur_amount], [currency], [dc_flag], [description], [dim_1], [dim_2], [dim_3], [dim_4], [dim_5], [dim_6], [dim_7], [ext_arch_ref], [ext_inv_ref], [ext_ref], [number_1], [order_id], [period], [sequence_no], [status], [tax_code], [tax_system], [trans_date], [value_1], [value_2], [value_3], [voucher_date], [voucher_no], [voucher_type]) VALUES (N'9999', CAST(-7000.000 AS Decimal(28, 3)), N'', N' ', N'C1  ', N'B0  ', N'    ', N'    ', N'BF  ', N'C0  ', N'    ', N'BT', CAST(-7000.000 AS Decimal(28, 3)), N'NOK', -1, N'EF-test: Row X, slump for balanse i hovedboka', N'13601010', N'110003', N'', N'', N'110003101', N'99999', N'', N'                                                  ', N'', N'', 0, 0, 201911, 0, N' ', N'0', N'', CAST(N'2019-11-15 10:02:53.880' AS DateTime), CAST(0.00000000 AS Decimal(28, 8)), CAST(0.000 AS Decimal(28, 3)), CAST(0.000 AS Decimal(28, 3)), CAST(N'2019-11-15 10:02:53.880' AS DateTime), @hbvoucherno+10, N'HB')

UPDATE acrtransgr SET counter=(SELECT MAX(voucher_no)+1 FROM agltransact WHERE client='BT' AND voucher_type='HB') WHERE client='BT' AND vouch_series='HB'

ROLLBACK
COMMIT